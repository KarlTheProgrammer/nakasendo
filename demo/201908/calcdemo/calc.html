<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8">
      <link rel="stylesheet" type="text/css" href="css/style.css">       
      <link rel="icon" type="image/png" href="calculator-icon.png">
      <title>BigNum calculator</title>         
  </head>
<body>
    <script>


    // Dynamically load the ES module, so that we are able to access its exports. TODO: consider removing modules...

    // http://exploringjs.com/es6/ch_modules.html#sec_modules-vs-scripts
    // The synchronous nature of scripts prevents them from becoming modules. 
    // Scripts cannot even import modules declaratively
    // (you have to use the programmatic module loader API if you want to do so).


      calculator = null;
      var Module = {};

      // After WASM is loaded, we will create an instance of Calculator
      Module.onRuntimeInitialized = function() {        
        import("./dist/calc.js").then(
          module => { 
	    console.log("Creating a calculator class");
            calculator = new module.Calculator();                
            document.onkeydown = onKeyDown;        
            document.onkeypress = onKeyPress;        
          }).catch(
            err => { 
              console.log(err) 
          });
      };          

      function onKeyDown(ev)
      {
        document.getElementById('entry').value = calculator.onKeyDown(ev, document.getElementById('entry').value);
      }

      function onKeyPress(ev)
      {
        document.getElementById('entry').value = calculator.onKeyPress(ev, document.getElementById('entry').value);
      }
    </script>


    <!-- Hello js contains runtim egenerated by emscripten. It initializes Module by providing
     additional members and loads WASM. -->
    <script async type="text/javascript" src="nakasendo/CryptoBase.js"></script>          
    </script>

    <div class="container">
      <div>
        <img src="Nakasendo-logo.svg" alt="Nakasendo SDK Logo" width="374" height="109">  
      </div>          
      <div class="calculator">
          <div class="display">
              <input type="text" class="display" id = "entry" value="0" oninput="calculator.updateInfoAndFontSize(document.getElementById('entry').value);">
          </div>    
          <div class="info">
              Number of digits: 0
          </div>            
          <div class="keys">
              <button class="operator" onclick="document.getElementById('entry').value = calculator.onButtonClick('add', document.getElementById('entry').value)">+</button>
              <button class="operator" onclick="document.getElementById('entry').value = calculator.onButtonClick('subtract', document.getElementById('entry').value)">-</button>
              <button class="operator" onclick="document.getElementById('entry').value = calculator.onButtonClick('multiply', document.getElementById('entry').value)">&times;</button>
              <button class="operator" onclick="document.getElementById('entry').value = calculator.onButtonClick('divide', document.getElementById('entry').value)">&divide;</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('7', document.getElementById('entry').value)">7</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('8', document.getElementById('entry').value)">8</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('9', document.getElementById('entry').value)">9</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('4', document.getElementById('entry').value)">4</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('5', document.getElementById('entry').value)">5</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('6', document.getElementById('entry').value)">6</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('1', document.getElementById('entry').value)">1</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('2', document.getElementById('entry').value)">2</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('3', document.getElementById('entry').value)">3</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('0', document.getElementById('entry').value)">0</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('random', document.getElementById('entry').value)">RND</button>
              <button onclick="document.getElementById('entry').value = calculator.onButtonClick('clear', document.getElementById('entry').value)">CE</button>
              <button class="equal" onclick="document.getElementById('entry').value = calculator.onButtonClick('result', document.getElementById('entry').value)">=</button>              
          </div>
      </div>          
  </body>
  </html>
